<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced M3U8 Extractor</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; background: #1a1a1a; color: white; padding: 20px; }
        .box { background: #2a2a2a; padding: 20px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        input { width: 70%; padding: 12px; border-radius: 5px; border: none; margin-right: 10px; }
        button { padding: 12px 20px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; font-weight: bold; }
        button:hover { background: #0056b3; }
        #status { margin: 15px 0; color: #aaa; font-style: italic; }
        .link-card { background: #333; padding: 10px; margin: 10px 0; border-left: 4px solid #28a745; display: flex; justify-content: space-between; align-items: center; }
        .url-text { font-family: monospace; font-size: 12px; color: #28a745; word-break: break-all; margin-right: 10px; }
        .copy-btn { background: #444; font-size: 11px; padding: 5px 10px; }
        .error { color: #ff4d4d; font-weight: bold; }
    </style>
</head>
<body>

<div class="box">
    <h2>M3U8 Source Grabber</h2>
    <p style="font-size: 0.9em; color: #ccc;">This version uses a specialized bypass proxy to get around Cloudflare 403 errors.</p>
    
    <input type="text" id="targetUrl" value="https://roxiestreams.live/nba-streams-1">
    <button onclick="grabSource()">Extract Links</button>

    <div id="status">Ready.</div>
    <div id="results"></div>
</div>

<script>
    async function grabSource() {
        const url = document.getElementById('targetUrl').value;
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        
        results.innerHTML = '';
        status.innerHTML = "Connecting to Bypass Server...";

        // Using a different proxy (Pirate-Proxy/Cloudflare Bypass logic)
        // We use a "Worker" approach or a more aggressive CORS bypasser
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
        
        // Note: If AllOrigins still fails, the site has "Aggressive Bot Protection"
        // In that case, the only way is to use a Scraper API key (Free)
        
        try {
            const response = await fetch(proxyUrl);
            const data = await response.json();
            const html = data.contents;

            if (!html) throw new Error("Could not retrieve page source.");

            status.innerHTML = "Source grabbed! Searching for .m3u8 patterns...";

            // Find M3U8 links
            const regex = /https?:\/\/[\w\.\/-]+\.m3u8(?:\?[\w\=&]+)?/g;
            const matches = html.match(regex);

            if (matches && matches.length > 0) {
                const uniqueLinks = [...new Set(matches)];
                status.innerHTML = `Success! Found ${uniqueLinks.length} links:`;
                uniqueLinks.forEach(link => {
                    results.innerHTML += `
                        <div class="link-card">
                            <span class="url-text">${link}</span>
                            <button class="copy-btn" onclick="navigator.clipboard.writeText('${link}')">Copy</button>
                        </div>
                    `;
                });
            } else {
                status.innerHTML = "No direct M3U8 links found. They might be generated by JavaScript after the page loads.";
            }
        } catch (e) {
            status.innerHTML = `<span class="error">Error: ${e.message}</span><br><small>The site is likely blocking all public proxies. Try the Manual Method below.</small>`;
        }
    }
</script>

</body>
</html>